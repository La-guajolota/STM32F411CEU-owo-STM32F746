/*
 * DRV8825.c
 *
 *  Created on: May 29, 2024
 *      Author: AdriÃ¡n Silva Palafox
 */

/*
 * Inlcudes
 */
#include "DRV8825.h"

/*
 * Variables
 */
extern TIM_HandleTypeDef htim2;

#define timer &htim2
#define channel TIM_CHANNEL_1
#define half_duty 999

/*
 * Pines de control
 * Repetir segun la cantidad de drivers
 */

/*
 * Definicion de los prototipados
 */
void init_driver(DRV8825_t* driver,uint32_t steps_max)
{
	HAL_GPIO_WritePin(ENABLE_GPIO_Port, ENABLE_Pin, OFF_DRIVER);

	//Seteamos a un dutycycle de 50%
	__HAL_TIM_SET_COMPARE(timer,channel,half_duty);

	//defaults
	driver->dir = 0;
	driver->mode = FULL_STEP;
	driver->state = OFF_DRIVER;
	driver->step = 0;

	//Por el usuario
	driver->steps_max = steps_max;
}

void move(DRV8825_t* driver,uint8_t dir, uint8_t mode)
{
	//State
	driver->state = ON_DRIVER;

	//Direcion de giro
	HAL_GPIO_WritePin(DIR_GPIO_Port,DIR_Pin,dir);

	//Modo de operacion
	HAL_GPIO_WritePin(MODE0_GPIO_Port, MODE0_Pin,mode&0b001);
	HAL_GPIO_WritePin(MODE1_GPIO_Port, MODE1_Pin,mode&0b010);
	HAL_GPIO_WritePin(MODE2_GPIO_Port, MODE2_Pin,mode&0b100);


}

void move_steps(DRV8825_t* driver,uint8_t dir, uint8_t mode, uint32_t steps)
{

}

